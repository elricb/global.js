/**
 * Parse the URL
 * dependancies: javascript 1.0, w3c DOM 1.0, Cast
 * from: objects/URL.js
 * example: http://somewhere.domain.com:21/hi.html?v=3&c=2#chapter
 */
var URL={
    version   : 1.1,
    href      : Cast.cstring(window.location.href),        //http://somewhere.domain.com:21/hi.html?v=3&c=2#chapter
    host      : Cast.cstring(window.location.hostname),    //somewhere.domain.com
    domain    : "",                                        //domain.com
    hash      : Cast.cstring(window.location.hash),        //#chapter
    port      : Cast.cstring(window.location.port),        //21
    protocol  : Cast.cstring(window.location.protocol),    //http:
    //v=3&c=2
    query     : 1<Cast.cstring(window.location.search).split("?").length?Cast.cstring(window.location.search).split("?")[1]:Cast.cstring(window.location.search),
    
    setValues : function(){return this.setDomain().setPort();},
    setDomain : function(){this.domain=Cast.cstring(window.location.hostname); var a=this.domain.split(".");if(1>a.length){for(var a=window.location.href.split("/"),b=0;b<a.length&&-1==a[b].indexOf(".");b++);a=a[b].split(".")}2<a.length&&a.shift();this.domain=a.join(".");return this;},
    setPort   : function(){this.port=Cast.cstring(this.port);this.port||(this.port="21");return this;},
    getQuery  : function(a){a=Cast.cstring(a);if(!a)return this.query;for(var b=this.query.split("&"),c=0;c<b.length&&b[c].substr(0,b[c].indexOf("="))!=a;c++);return b[c].substr(0,b[c].indexOf("="))!=a?"":b[c].substr(b[c].indexOf("=")+ 1);},
    setQuery  : function(a,b){a=Cast.cjson(a);b=Cast.isString(b)?b:this.query;var c=b.split("&"),e={},d;for(d in c)(k2=Cast.cstring(c[d].split("=")[0]))&&(e[k2]=Cast.cstring(c[d].split("=")[1]));for(d in a)e[d]=Cast.cstring(a[d]);if("function"==typeof jQuery)return jQuery.param(e);c="";for(d in e)c+="&"+d+"="+e[d];return c.replace(/^&/,"");}
};
URL.setValues();