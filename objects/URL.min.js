/**
 * Parse the URL
 * dependancies: javascript 1.0, w3c DOM 1.0, Cast
 * from: objects/URL.js
 * example: http://somewhere.domain.com:21/hi.html?v=3&c=2#chapter
 */
var URL={
    version:1.3,
    cookieMax:4E3,
    href:Cast.cstring(window.location.href),            //http://somewhere.domain.com:21/hi.html?v=3&c=2#chapter
    host:Cast.cstring(window.location.hostname),        //somewhere.domain.com
    domain:"",                                          //domain.com
    hash:Cast.cstring(window.location.hash),            //#chapter
    port:Cast.cstring(window.location.port),            //21
    protocol:Cast.cstring(window.location.protocol),    //http:
    path:"",                                            //'/folder/file.dat'
    file:"",
    //v=3&c=2
    query:1<Cast.cstring(window.location.search).split("?").length?Cast.cstring(window.location.search).split("?")[1]:Cast.cstring(window.location.search),
    
    setDefaults:function(){this.getDomain();this.getPath()},
    getDomain:function(){this.domain=Cast.cstring(this.hostname);var a=this.domain.split(".");if(1>a.length){for(var a=this.href.split("/"),b=0;b<a.length&&-1==a[b].indexOf(".");b++);a=a[b].split(".")}2<a.length&&a.shift();return this.domain=a.join(".")},
    getPath:function(){var a=this.href.match(/[^:][^/][^/]\/([^\?\#]*)/);a?1<a.length&&(a=a[1]):a="";return this.path=a},
    getQuery:function(a){a=Cast.cstring(a);if(!a)return this.query;for(var b=this.query.split("&"),c=0;c<b.length&&b[c].substr(0,b[c].indexOf("="))!=a;c++);return b[c].substr(0,b[c].indexOf("="))!=a?"":b[c].substr(b[c].indexOf("=")+1)},
    setQuery:function(a,b){a=Cast.cjson(a);b=Cast.isString(b)?b:this.query;var c=b.split("&"),d={},e;for(e in c)(k2=Cast.cstring(c[e].split("=")[0]))&&(d[k2]=Cast.cstring(c[e].split("=")[1]));for(e in a)d[e]=Cast.cstring(a[e]);if("function"==typeof jQuery)return jQuery.param(d);c="";for(e in d)c+="&"+e+"="+d[e];return c.replace(/^&/,"")},
    encode:function(a){return"undefined"==typeof encodeURIComponent?escape(a):encodeURIComponent(a)},
    decode:function(a){return"undefined"==typeof decodeURIComponent?unescape(a):decodeURIComponent(a)},
    setCookie:function(a,b,c,d){var e="",f="",f=new Date;c=Cast.cstring(c,"/");b=this.encode(Cast.cstring(b));Cast.cint(d)&&(f.setTime(f.getTime()+864E5*d),e="; expires="+f.toGMTString());f=a+"="+b+e+"; path="+c;if(f.length>this.cookieMax)return!1;try{document.cookie=f}catch(g){return!1}return!0},
    getCookie:function(a){try{var b=document.cookie}catch(c){b=""}var d;a+="=";for(var e=b.split(";"),b=0;b<e.length;b++){for(d=e[b];" "==d.charAt(0);)d=d.substring(1,d.length);if(0==d.indexOf(a))return this.decode(d.substring(a.length,d.length))}return null},
    getCookies:function(){try{var a=document.cookie}catch(b){a=""}for(var c,d=a.split(";"),e={},a=0;a<d.length;a++)c=d[a].indexOf("="),d[a].substr(0,c).trim(),e[c]=this.decode(d[a].substr(c+1));return e}
};
URL.setDefaults();
