/**
 * Element and Image global objects
 * From: objects/Elements.js
 * dependancies:  jQuery 1.6+, Cast3.5+, DOMImage
 */
var Elements={
    version : 3.12,
    o       : [],     //stored jquery elements (attach id# to element)
    tick    : 200,    //resize timer tick for 'afterresize' event
    timeout : false,  //performing resize
    pxToIn  : 0,      //physical aspect ratio
    getPxToIn:function(){return Cast.cint(jQuery("<div style='display:block;position:relative;width:1in;margin:0px;padding:0px;border:none;' />").width())},
    isHTMLNode:function(a){return"object"===typeof Node?a instanceof Node:a&&"object"===typeof a&&"number"===typeof a.nodeType&&"string"===typeof a.nodeName},
    isHTMLElement:function(a){return"object"===typeof HTMLElement?a instanceof HTMLElement:a&&"object"===typeof a&&null!==a&&1===a.nodeType&&"string"===typeof a.nodeName},
    isHTMLObject:function(a){return Elements.isHTMLElement()|| Elements.isHTMLNode()},
    add:function(a){var b=Elements.o.length;Elements.o[b]=Cast.cjquery(a);return b},
    get:function(a){a=Cast.cint(a);return a<Elements.o.length?Elements.o[a]:jQuery()},
    loadFile:function(c,a,b){a=Cast.cstring(a,"text");b=Cast.cobject(b);return Cast.cjqxhr(jQuery.ajax({url:c,data:b,dataType:a}))},
    populate:function(e,f,c){c="undefined"==typeof c?/\{\{(.+?)\}\}/g:c;return e.replace(c,function(g,d){var a=Cast.cstring(d).split("."),b=Cast.ctree(f,!1,d)||Cast.ctree(f,null,a),h="";if(b&&"object"==typeof b||"function"==typeof b||"array"==typeof b)if(b.constructor==Object||b.constructor==Array||b.constructor==Function)return"function"==typeof jQuery&&jQuery.isEmptyObject(b)?"":Elements.populate(e,b,c);if(null!=b)return b;"function"==typeof jQuery&&a.length&&jQuery.ajax({url:a.join("."), async:!1,dataType:"text",success:function(a){h+=Elements.populate(a,b||f,c)}});return h})},
    populateTag:function(e,f,c,g){c="undefined"==typeof c?"tpt":c;e=jQuery("<div>"+e+"</div>");e.find(c).each(function(d){d=jQuery(this);var a=Cast.cstring(d.attr("key")),a=Cast.ctree(f,null,a),b=Cast.cstring(d.attr("rex"));if(b&&a&&!RegExp(b).test(a))return d.html(""),!0;if(a&&"object"==typeof a||"function"==typeof a||"array"==typeof a)if(a.constructor==Object||a.constructor==Array||a.constructor==Function){a= a||f;if(Cast.cboolean(d.attr("loop"))){var b="",c;for(c in a)b+=Elements.populate(d.html(),a[c],g);d.html(b);return!0}d.html(Elements.populate(d.html(),a,g))}d.html(Elements.populate(d.html(),f,g))});return e.html()},
    checkBox:function(a,b,c,d){a=Cast.cjquery(a);if(!a.length)return jQuery();d=Cast.cboolean(d);a.after("<img />");var e=a.next("img");e.attr("imgOn",b).attr("imgOff",c).attr("src",d?b:c).show();d?a.attr("checked","checked"):a.removeAttr("checked");a.hide();e.click(function(){var a=jQuery(this).prev();a.attr("checked")?a.removeAttr("checked"):a.attr("checked","checked");a.change()});a.change(function(a){a=jQuery(a.target).next("img");a.attr("src",a.attr(jQuery(this).attr("checked")?"imgOn":"imgOff")); return!0});return e},
    setLink:function(a){a=Cast.cjquery(a);a.css("cursor","pointer");a.click(function(){var a=jQuery(this),c=Cast.cstring(a.attr("href")),a=Cast.cstring(a.attr("target"));c&&(a?window.open(c,a):window.location.href=c)});return this},
    getContainer:function(a,b){var c=jQuery();b=Cast.cobject(b);Cast.isString(b.parent)?c=a.parents(b.parent):Cast.isObject(b.parent)?c=Cast.cjquery(b.parent):Cast.cboolean(b.parent)&&(c=a.parent());c.length&&(b.width=c.width(),b.height=c.height());if(Cast.cint(b.width)&& Cast.cint(b.height))return{width:b.width,height:b.height,jq:c};c=a.parent();c.length||(c=jQuery(window));return{width:c.width(),height:c.height(),jq:c}},
    center:function(a,b){var c,d={parent:!1,width:0,height:0,vertical:!0,horizontal:!0,persist:!0};a=Cast.cjquery(a);b=Cast.cobject(b);for(c in d)d[c]="undefined"!=typeof b[c]?b[c]:d[c];container=Elements.getContainer(a,d);parent=container.jq;return!parent.length||d.horizontal&&!d.vertical?Cast.cint(container.width)&&Cast.cint(container.height)?Elements.centerArea(a, container.width,container.height):a.css({"margin-left":"auto","margin-right":"auto","vertical-align":"middle"}):d.persist?Elements.centerParentResize(a,parent):Elements.centerParent(a,parent)},
    centerParent:function(a,b){var c=Cast.cstring(a.css("position"));return"absolute"==c||"fixed"==c?a.css({left:Math.round((b.outerWidth()||b.width())/2-(a.outerWidth()||a.width())/2)+"px",top:Math.round((b.outerHeight()||b.height())/2-(a.outerHeight()||a.height())/2)+"px"}):a.css({"margin-left":Math.round((b.outerWidth()|| b.width())/2-(a.outerWidth()||a.width())/2)+"px","margin-top":Math.round((b.outerHeight()||b.height())/2-(a.outerHeight()||a.height())/2)+"px"})},
    centerArea:function(a,b,c){var d=Cast.cstring(a.css("position"));return"absolute"==d||"fixed"==d?a.css({left:Math.round(b/2-(a.outerWidth()||a.width())/2)+"px",top:Math.round(c/2-(a.outerHeight()||a.height())/2)+"px"}):a.css({"margin-left":Math.round(b/2-(a.outerWidth()||a.width())/2)+"px","margin-top":Math.round(c/2-(a.outerHeight()||a.height())/2)+"px"})},
    centerParentResize:function(a,b){a=Cast.cjquery(a);b=Cast.cjquery(b);Elements.centerParent(a,b);if("function"!=typeof b.on)return b.bind("resize",function(){Elements.centerParent(a,b)});Elements.startAfterResizeEvent(b);return jQuery(b).on("afterresize",{jqp:b,jqe:a},function(a){Elements.centerParent(a.data.jqe,a.data.jqp)})},
    toggle:function(a,b,c){c=Cast.cjson(c);a=Cast.cjquery(a);b=Cast.cjquery(b);c.j=Elements.add(a);c.t=Cast.cboolean(c.t,!0);c.w=Cast.cboolean(c.w,!1);c.h=Cast.cboolean(c.h,!0); if(!a.width()||!a.height()){var d=a.clone().css({height:"auto",width:"auto"}).appendTo("body");c.h&&(c.h=d.height());c.w&&(c.w=d.width());d.remove()}c.w&&(c.w=Math.max(a.width(),Cast.cint(c.w)));c.h&&(c.h=Math.max(a.height(),Cast.cint(c.h)));b.data("toggle",Cast.csjson(c));b.click(function(b){var c=jQuery(b.target),d=Cast.cjson(c.data("toggle"));d.t=Cast.cboolean(d.t);b=Cast.cint(d.w);var g=Cast.cint(d.h),f=Elements.get(Cast.cint(d.j));b&&(d.t?f.animate({width:0},function(){d.t=!1;c.data("toggle", Cast.csjson(d))}):f.animate({width:b},function(){d.t=!0;c.data("toggle",Cast.csjson(d))}));g&&(d.t?f.animate({height:0},function(){d.t=!1;c.data("toggle",Cast.csjson(d))}):f.animate({height:g},function(){d.t=!0;c.data("toggle",Cast.csjson(d))}));a.trigger("toggled")})},
    startAfterResizeEvent:function(a){"undefined"==typeof Elements.startAfterResizeEventOn&&("undefined"==typeof a&&(a=window),Elements.startAfterResizeEventOn=!0,Elements.timeout=!1,$(a).on("resize",{jqp:a},function(){Elements.windowTime= new Date;!1===Elements.timeout&&(Elements.timeout=!0,setTimeout(Elements.afterResize,Elements.tick))}))},
    afterResize:function(a){new Date-Elements.windowTime<Elements.tick?setTimeout(Elements.afterResize,Elements.tick):(Elements.timeout=!1,jQuery(window).trigger("afterresize"))},
    elementData:function(a,b,c){var d={};a=Cast.cjquery(a);"object"==typeof b?(c=b,b="default"):(b=Cast.cstring(b))||(b="default");Cast.cjson(c);a.each(function(){d=Cast.cjson(a.data(b));jQuery.extend(d,c);a.data(b,d)});return d},
    unifyDimensions:function(a,b,c){var d=0,e=0;b=Cast.cboolean(b,!0);c=Cast.cboolean(c,!0);a=Cast.cjquery(a);a.each(function(){ajqo=$(this);ajqo.width()>d&&(d=ajqo.width());ajqo.height()>e&&(e=ajqo.height())});a.each(function(){ajqo=$(this);b&&ajqo.width(d);c&&ajqo.height(e)});return a},
    resize:function(a,b,c,d){Cast.isNumber(b)&&(b=Cast.cint(b)+"px");Cast.isNumber(c)&&(c=Cast.cint(c)+"px");b||(b=a.width()+"px");c||(c=a.height()+"px");d=Cast.cint(d);return 0<d?a.stop().animate({width:b,height:c},d,function(){a.trigger("afterresize")}): a.css({width:b,height:c}).trigger("afterresize")},
    loading:function(a,b){Elements.loading.img=$();a=Cast.cstring(a);b=Cast.cjquery(b);b.length||(b=jQuery("body"));if(!a||!b.length)return console.log("Elements.loading img error"),jQuery();Elements.loading.img=jQuery('<img src="'+a+'" style="display:none;" />');Elements.loading.img.appendTo(b);Elements.loading.img.load(function(){$(this).css({position:"fixed","z-index":1E4,left:"50%",top:"50%","margin-left":"-"+Elements.loading.img.width/2+"px","margin-top":"-"+ Elements.loading.img.height/2+"px"})}).error(function(){console.log("Elements.loading img '"+a+"' does not exist")});Elements.loading.src=a;return Elements.loading.img}
};
Elements.loading.show=function(){Elements.loading.img.length&&Elements.loading.img.fadeIn()};
Elements.loading.hide=function(){Elements.loading.img.length&&Elements.loading.img.fadeOut()};

var Images={
    version:1.2,
    setLoaded:function(a,b){b=Cast.cboolean(b,!0);Cast.cjquery(a).data("loaded",b);return this},
    isLoaded:function(a){return Cast.cboolean(Cast.cjquery(a).data("loaded"))},
    loadImages:function(a){a=Cast.cjquery(a);var b=this;return jQuery.Deferred(function(c){a.each(function(d,e){b.loadImage(jQuery(e)).done(function(b,e,g){d>=a.length-1&&c.resolve(a)})});a.length||c.reject(a,"no image elements to preload")}).promise()},
    loadImage:function(a){var b=this;return jQuery.Deferred(function(c){a= Cast.cjquery(a);var d=new Image,e=Cast.cstring(a.attr("src"));d.onload=function(){Elements.elementData(a,{owidth:d.width,oheight:d.height});b.setLoaded(a);c.resolve(d.width,d.height,a)};d.onerror=function(b){Elements.elementData(a,{owidth:a.width(),oheight:a.height()});c.reject(a.width(),a.height(),a,"invalid src: "+e)};d.src=e;d.complete&&(Elements.elementData(a,{owidth:d.width,oheight:d.height}),b.setLoaded(a),c.resolve(d.width,d.height,a))}).promise()},
    getRatioW:function(a,b){var c=Cast.cobject(Elements.elementData(a)), c=Cast.cint(c.owidth)/Cast.cint(c.oheight);return isNaN(c)?0:b*c},
    getRatioH:function(a,b){var c=Cast.cobject(Elements.elementData(a)),c=Cast.cint(c.oheight)/Cast.cint(c.owidth);return isNaN(c)?0:b*c},
    resizeW:function(a,b,c){return Elements.resize(a,b,this.getRatioH(a,b),c)},
    resizeH:function(a,b,c){return Elements.resize(a,this.getRatioW(a,b),b,c)},
    fitInParent:function(a,b,c,d){b=Elements.getContainer(a,b);return this.fitInArea(a,b.width,b.height,c,d)},
    fitInArea:function(a,b,c,d,e){e=Cast.cboolean(e); return e==Math.abs(a.width()-b)<Math.abs(a.height()-c)?this.resizeW(a,b,d):this.resizeH(a,c,d)},
    fitImages:function(a,b){a=Cast.cjquery(a);var c=this;return jQuery.Deferred(function(d){a.each(function(e,f){c.fitImage(jQuery(f),b).done(function(b,c,f){e>=a.length-1&&d.resolve(f)})});a.length||d.reject(a)}).promise()},
    fitImage:function(a,b){var c=this;return this.loadImage(a).done(function(a,e,f){data={parent:!1,width:0,height:0,speed:0,bound:!0};jQuery.extend(data,Cast.cobject(b));Elements.elementData(f, "container",data);a=Elements.getContainer(f,data);c.fitInArea(f,a.width,a.height,data.speed,!data.bound)})},
    exists:function(a){return jQuery.Deferred(function(b){"undefined"!=typeof a&&a||b.reject(b,"fail","blank url","");jQuery("<img src='"+a+"' />").load(function(){b.resolve(a,"success",b)}).error(function(){b.reject(b,"fail","error loading image",a)})}).promise()},
    svg:function(a,b){a=Cast.cjquery(a);b=Cast.cstring(b);if(!Images.svgSupported())return a;a.each(function(){var a=$(this);b||(b=Cast.cstring(a.attr("svg"))); "img"==a.prop("tagName")?a.attr("src",b):a.attr("background-image","url("+b+")")});return a},
    svgSupported:function(){if("undefined"!=typeof Images.bSvgSupported)return Images.bSvgSupported;var a=document.createElement("img");a.setAttribute("src","data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNzUiIGhlaWdodD0iMjc1Ij48L3N2Zz4%3D");Images.bSvgSupported=a.complete;return Images.bSvgSupported}
};

//jQuery plugins
"function"===typeof jQuery&&(
    Elements.pxToIn=Elements.getPxToIn(),
    jQuery.fn.fitIn=function(a){return Images.fitImages(this,a)},
    jQuery.fn.preload=function(){return Images.loadImages(this)},
    jQuery.fn.resize=function(a,b,c){return Elements.resize(jQuery(this),a,b,c)},
    jQuery.fn.center=function(a){return Elements.center(jQuery(this),a)}
);
