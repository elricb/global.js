/**
 * Element and Image functions
 * From: objects/Elements.js
 * dependancies:  jQuery 1.6+, Cast, Image
 */
var Elements = {version:3.2};
var Images   = {version:1.1};

if (typeof jQuery=='function') {
    jQuery.fn.fitIn=function(a){return Images.fitImages(this,a)};
    jQuery.fn.preload=function(){return Images.loadImages(this)};
    jQuery.fn.resize=function(a,b,c){return Elements.resize($(this),a,b,c)};
    jQuery.fn.center=function(a){return Elements.center($(this),a)}; 
}
    Elements.checkBox=function(a,d,e,b){a=Cast.cjquery(a);if(!a.length)return jQuery();b=Cast.cboolean(b);a.after("<img />");var c=a.next("img");c.attr("imgOn",d).attr("imgOff",e).attr("src",b?d:e).show();b?a.attr("checked","checked"):a.removeAttr("checked");a.hide();c.click(function(){var a=jQuery(this).prev();a.attr("checked")?a.removeAttr("checked"):a.attr("checked","checked");a.change()});a.change(function(a){a=jQuery(a.target).next("img");a.attr("src",a.attr(jQuery(this).attr("checked")?"imgOn": "imgOff"));return!0});return c};
    Elements.setLink=function(a){a=Cast.cjquery(a);a.css("cursor","pointer");a.click(function(){var b=$(this),a=Cast.cstring(b.attr("href")),b=Cast.cstring(b.attr("target"));a&&(b?window.open(a,b):window.location.href=a)});return this};
    Elements.center=function(a,b){var c=Elements.elementData(a,"container"),d={parent:!1,width:0,height:0,vertical:!0,horizontal:!0,position:"absolute"};jQuery.extend(d,c,Cast.cobject(b));Elements.elementData(a,"container",d);container=this.getContainer(a,d);itop=container.height()/2-a.height()/2;ileft=container.width()/2-a.width()/2;"absolute"==d.position?a.css({position:"absolute",left:d.horizontal?ileft:Cast.cint(a.css("left")),top:d.vertical?itop:Cast.cint(a.css("top"))}):a.css({position:"relative", "margin-left":d.horizontal?ileft:Cast.cint(a.css("margin-left")),"margin-top":d.vertical?itop:Cast.cint(a.css("margin-top"))});return a};
    Elements.elementData=function(a,b,c){"object"==typeof b&&(c=b,b="");c=Cast.cobject(c);(b=Cast.cstring(b))||(b="default");a=Cast.cjquery(a);1<a.length&&(a=a.get(0));if(a.length){var d=Cast.cobject(a.data("Images"));d[b]=Cast.cobject(d[b]);$.extend(d[b],c);a.data("Images",d);return d[b]}return{}}; 
    Elements.resize=function(a,b,c,d){Cast.isNumber(b)&&(b+="px");Cast.isNumber(c)&&(c+="px");d=Cast.cint(d);return 0<d?a.animate({width:b,height:c},d):a.css({width:b,height:c})};
    Images.setLoaded=function(a,b){b=Cast.cboolean(b,!0);Cast.cjquery(a).data("loaded",b);return this};
    Images.isLoaded=function(a){return Cast.cboolean(Cast.cjquery(a).data("loaded"))};
    Images.loadImages=function(a){a=Cast.cjquery(a);var b=this;return jQuery.Deferred(function(c){a.each(function(d,e){b.loadImage($(e)).done(function(b,e,g){d>=a.length-1&&c.resolve(g)})});a.length||c.reject(a,"no image elements to preload")}).promise()}; 
    Images.loadImage=function(a){var b=this;return jQuery.Deferred(function(c){var d=Cast.cobject(Elements.elementData(a));if(0!=Cast.cint(d.owidth)&&0!=Cast.cint(d.oheight))return c.resolve(d.owidth,d.oheight,a),this;var e=new Image,f=Cast.cstring(a.attr("src"));e.onload=function(){Elements.elementData(a,{owidth:e.width,oheight:e.height});b.setLoaded(a);c.resolve(e.width,e.height,a)};e.onerror=function(b){Elements.elementData(a,{owidth:a.width(),oheight:a.height()});c.reject(a.width(),a.height(),a,"invalid src: "+ f)};e.src=f;e.complete&&"pending"==c.state&&(Elements.elementData(a,{owidth:e.width,oheight:e.height}),b.setLoaded(a),c.resolve(e.width,e.height,a))}).promise()};
    Images.getRatioW=function(a,b){var c=Cast.cobject(Elements.elementData(a)),c=Cast.cint(c.owidth)/Cast.cint(c.oheight);return isNaN(c)?0:b*c};
    Images.getRatioH=function(a,b){var c=Cast.cobject(Elements.elementData(a)),c=Cast.cint(c.oheight)/Cast.cint(c.owidth);return isNaN(c)?0:b*c}; 
    Images.resizeW=function(a,b,c){return Elements.resize(a,b,this.getRatioH(a,b),c)};
    Images.resizeH=function(a,b,c){return Elements.resize(a,this.getRatioW(a,b),b,c)};
    Images.fitInParent=function(b,a,c,d){a=Elements.getContainer(b,a);return this.fitInArea(b,a.width,a.height,c,d)};
    Images.fitInArea=function(a,b,c,d,e){e=Cast.cboolean(e);return e==Math.abs(a.width()-b)<Math.abs(a.height()-c)?this.resizeW(a,b,d):this.resizeH(a,c,d)};
    Images.fitImages=function(a,b){a=Cast.cjquery(a);var c=this;return jQuery.Deferred(function(d){a.each(function(e,f){c.fitImage($(f),b).done(function(b,c,f){e>=a.length-1&&d.resolve(f)})});a.length||d.reject(a)}).promise()}; 
    Images.fitImage=function(c,d){var e=this;return this.loadImage(c).done(function(a,c,b){data={parent:!1,width:0,height:0,speed:0,bound:!0};jQuery.extend(data,Cast.cobject(d));Elements.elementData(b,"container",data);a=Elements.getContainer(b,data);e.fitInArea(b,a.width,a.height,data.speed,!data.bound)})};
    Images.exists=function(b){return jQuery.Deferred(function(a){"undefined"!=typeof b&&b||a.reject(a,"fail","blank url","");jQuery("<img src='"+b+"' />").load(function(){a.resolve(b,"success",a)}).error(function(){a.reject(a,"fail","error loading image",b)})}).promise()};
