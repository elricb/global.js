/**
 * Element and Image global objects
 * From: objects/Elements.js
 * dependancies:  jQuery 1.6+, Cast3.5+, DOMImage
 */
var Elements={
    version:3.14,
    o:[],
    tick:200,
    timeout:!1,
    pxToIn:"function"==typeof jQuery?this.getPxToIn():0,
    getPxToIn:function(){return Cast.cint(jQuery("<div style='display:block;position:relative;width:1in;margin:0px;padding:0px;border:none;' />").width())},
    isHTMLNode:function(a){return"object"===typeof Node?a instanceof Node:a&&"object"===typeof a&&"number"===typeof a.nodeType&&"string"===typeof a.nodeName},
    isHTMLElement:function(a){return"object"===typeof HTMLElement?a instanceof HTMLElement:a&&"object"===typeof a&&null!==a&&1===a.nodeType&&"string"===typeof a.nodeName},
    isHTMLObject:function(a){return Elements.isHTMLElement()||Elements.isHTMLNode()},
    getSelector:function(a){(a=jQuery(this).parents().map(function(){return this.tagName}).get().reverse().join(" "))&&(a+=" "+$(this)[0].nodeName);var b=jQuery(this).attr("id");b&&(a+="#"+b);(b=jQuery(this).attr("class"))&&(a+="."+jQuery.trim(b).replace(/\s/gi,"."));return a},
    add:function(a){var b=Elements.o.length;Elements.o[b]=Cast.cjquery(a);return b},
    get:function(a){a=Cast.cint(a);return a<Elements.o.length?Elements.o[a]:jQuery()},
    loadFile:function(a,b,c){b=Cast.cstring(b,"text");c=Cast.cobject(c);return Cast.cjqxhr(jQuery.ajax({url:a,data:c,dataType:b}))},
    populate:function(a,b,c){c="undefined"==typeof c?/\{\{(.+?)\}\}/g:c;return a.replace(c,function(e,g){var h=Cast.cstring(g).split("."),d=Cast.ctree(b,!1,g)||Cast.ctree(b,null,h)||Cast.ctree(b,null,parseInt(g)),l="";if(Cast.isRecursive(d))return Elements.populate(a,d,c);if(null!=d)return d;"function"==typeof jQuery&&h.length&&jQuery.ajax({url:g,async:!1,dataType:"text",success:function(a){l+=Elements.populate(a,b,c)}});return l})},
    populateTags:function(a,b,c,e,g){var h,d,l,f,m,n;e=Cast.cboolean(e,!0);c="undefined"==typeof c?"tpl":c;Cast.isArray(c)||(c=[c]);for(l=0;l<c.length;l++)for(f=Elements.getRootTags(a,c[l]),d=0;d<f.length;d++)if(m=Cast.ctree(f[d].attr,"","key"),m=Cast.ctree(b,null,m)||b,(n=Cast.ctree(f[d].attr,"","rex"))&&m&&!RegExp(n).test(m))f.html="";else if(Cast.cboolean(Cast.ctree(f[d].attr,!1,"loop"))&&Cast.isRecursive(m)){n="";for(h in m)m[h].$0=h,n+=Elements.populate(Elements.populateTags(f[d].html,m[h],c,e,g),m[h],g);f.replace(d,n,e)}else f.replace(d,Elements.populate(Elements.populateTags(f[d].html,m,c,e,g),m,g),e);return f.html},
    getRootTags:function(a,b,c){var e=function(a,b,c){for(;c<b.length&&"/"===a.charAt(b[c]+1);c++);return c},g=function(a){var b=1,c={};for(a=a.replace(/ +(?= )/g,"").split(" ");b<a.length;b++)a[b]=a[b].split("="),a[b].length&&a[b][0]&&(c[a[b][0]]=((a[b][1]||"")+"").replace(/^['"]|['"]$/g,""));return c};b=function(a,b){for(var c=RegExp("</?"+b+"(>| [^>]*)","g"),e=[],d=0;-1!==(l=a.substr(d).search(c));)d+=l,e.push(d++);return e}(a,b);var h=e(a,b,0),d=[];c=Cast.cint(c,1E3);for(var l=0,f=h;f<c&&f<b.length;f++)"/"===a.charAt(b[f]+1)?l--:l++,0===l&&b[h]!==b[f]&&(k=a.indexOf(">",b[h]),k<b[f]&&d.push({pos:[b[h],a.indexOf(">",b[f])+1],ipos:[k+1,b[f]],attr:g(a.substring(b[h],k)),tag:a.substring(b[h],k+1),html:k<b[f]?a.substring(k+1,b[f]):""}),f=h=e(a,b,f),l=1);d.length=d.length;d.html=a;d.replace=function(a,b,c){var d=this.html.length;this.html="undefined"==typeof c?this.html.substr(0,this[a].pos[0])+b+this.html.substr(this[a].pos[1]):this.html.substr(0,this[a].ipos[0])+b+this.html.substr(this[a].ipos[1]);for(d-=this.html.length;a<this.length;a++)this[a].pos[0]-=d,this[a].pos[1]-=d,this[a].ipos[0]-=d,this[a].ipos[1]-=d};return d},
    overlay:function(a){return Cast.cjqxhr(!1,"function not created")},
    checkBox:function(a,b,c,e){a=Cast.cjquery(a);if(!a.length)return jQuery();e=Cast.cboolean(e);a.after("<img />");var g=a.next("img");g.attr("imgOn",b).attr("imgOff",c).attr("src",e?b:c).show();e?a.attr("checked","checked"):a.removeAttr("checked");a.hide();g.click(function(){var a=jQuery(this).prev();a.attr("checked")?a.removeAttr("checked"):a.attr("checked","checked");a.change()});a.change(function(a){a=jQuery(a.target).next("img");a.attr("src",a.attr(jQuery(this).attr("checked")?"imgOn":"imgOff"));return!0});return g},
    setLink:function(a){a=Cast.cjquery(a);a.css("cursor","pointer");a.click(function(){var a=jQuery(this),c=Cast.cstring(a.attr("href")),a=Cast.cstring(a.attr("target"));c&&(a?window.open(c,a):window.location.href=c)});return this},
    //getContainer:function(a,b){var c=jQuery();b=Cast.cobject(b);Cast.isString(b.parent)?c=a.parents(b.parent):Cast.isObject(b.parent)?c=Cast.cjquery(b.parent):Cast.cboolean(b.parent)&&(c=a.parent());c.length&&(b.width=c.width(),b.height=c.height());if(Cast.cint(b.width)&&Cast.cint(b.height))return{width:b.width,height:b.height,jq:c};c=a.parent();c.length||(c=jQuery(window));return{width:c.width(),height:c.height(),jq:c}},
    //centerParentResize:function(a,b){return Elements.centerInParent(a,b)},
    centerInParent:function(a,b){a=Cast.cjquery(a);b=Cast.cjquery(b);Elements.center(a,b);if("function"!=typeof b.on)return b.bind("resize",function(){Elements.center(a,b)});Elements.startAfterResizeEvent(b);return jQuery(b).on("afterresize",{jqp:b,jqe:a},function(a){Elements.center(a.data.jqe,a.data.jqp)})},
    //centerParent:function(a,b){return Elements.center(a,b)},
    center:function(a,b){var c=b.outerWidth()||b.width(),e=b.outerHeight()||b.height();return Elements.centerInArea(a,c,e)},
    centerInArea:function(a,b,c){var e=Cast.cstring(a.css("position"));return"absolute"==e||"fixed"==e?a.css({left:Math.round(b/2-(a.outerWidth()||a.width())/2)+"px",top:Math.round(c/2-(a.outerHeight()||a.height())/2)+"px"}):a.css({"margin-left":Math.round(b/2-(a.outerWidth()||a.width())/2)+"px","margin-top":Math.round(c/2-(a.outerHeight()||a.height())/2)+"px"})},
    toggle:function(a,b,c){c=Cast.cjson(c);a=Cast.cjquery(a);b=Cast.cjquery(b);c.j=Elements.add(a);c.t=Cast.cboolean(c.t,!0);c.w=Cast.cboolean(c.w,!1);c.h=Cast.cboolean(c.h,!0);if(!a.width()||!a.height()){var e=a.clone().css({height:"auto",width:"auto"}).appendTo("body");c.h&&(c.h=e.height());c.w&&(c.w=e.width());e.remove()}c.w&&(c.w=Math.max(a.width(),Cast.cint(c.w)));c.h&&(c.h=Math.max(a.height(),Cast.cint(c.h)));b.data("toggle",Cast.csjson(c));b.click(function(b){var c=jQuery(b.target),d=Cast.cjson(c.data("toggle"));d.t=Cast.cboolean(d.t);b=Cast.cint(d.w);var e=Cast.cint(d.h),f=Elements.get(Cast.cint(d.j));b&&(d.t?f.animate({width:0},function(){d.t=!1;c.data("toggle",Cast.csjson(d))}):f.animate({width:b},function(){d.t=!0;c.data("toggle",Cast.csjson(d))}));e&&(d.t?f.animate({height:0},function(){d.t=!1;c.data("toggle",Cast.csjson(d))}):f.animate({height:e},function(){d.t=!0;c.data("toggle",Cast.csjson(d))}));a.trigger("toggled")})},
    startAfterResizeEvent:function(a){"undefined"==typeof Elements.startAfterResizeEventOn&&("undefined"==typeof a&&(a=window),Elements.startAfterResizeEventOn=!0,Elements.timeout=!1,$(a).on("resize",{jqp:a},function(){Elements.windowTime=new Date;!1===Elements.timeout&&(Elements.timeout=!0,setTimeout(Elements.triggerAfterResize,Elements.tick))}))},
    triggerAfterResize:function(a){new Date-Elements.windowTime<Elements.tick?setTimeout(Elements.triggerAfterResize,Elements.tick):(Elements.timeout=!1,jQuery(window).trigger("afterresize"))},
    afterResize:function(a,b){b=Cast.cobject();return jQuery(window).on("afterresize",b,a)},
    elementData:function(a,b,c){var e={};a=Cast.cjquery(a);"object"==typeof b?(c=b,b="default"):(b=Cast.cstring(b))||(b="default");Cast.cjson(c);a.each(function(){e=Cast.cjson(a.data(b));jQuery.extend(e,c);a.data(b,e)});return e},
    unifyDimensions:function(a,b,c){var e=0,g=0;b=Cast.cboolean(b,!0);c=Cast.cboolean(c,!0);a=Cast.cjquery(a);a.each(function(){ajqo=$(this);ajqo.width()>e&&(e=ajqo.width());ajqo.height()>g&&(g=ajqo.height())});a.each(function(){ajqo=$(this);b&&ajqo.width(e);c&&ajqo.height(g)});return a},
    resize:function(a,b,c,e){Cast.isNumber(b)&&(b=Cast.cint(b)+"px");Cast.isNumber(c)&&(c=Cast.cint(c)+"px");b||(b=a.width()+"px");c||(c=a.height()+"px");e=Cast.cint(e);return 0<e?a.stop().animate({width:b,height:c},e,function(){a.trigger("afterresize")}):a.css({width:b,height:c}).trigger("afterresize")},
    loading:function(a,b){Elements.loading.img=$();a=Cast.cstring(a);b=Cast.cjquery(b);b.length||(b=jQuery("body"));if(!a||!b.length)return console.log("Elements.loading img error"),jQuery();Elements.loading.img=jQuery('<img src="'+a+'" style="display:none;" />');Elements.loading.img.appendTo(b);Elements.loading.img.load(function(){$(this).css({position:"fixed","z-index":1E4,left:"50%",top:"50%","margin-left":"-"+Elements.loading.img.width/2+"px","margin-top":"-"+Elements.loading.img.height/2+"px"})}).error(function(){console.log("Elements.loading img '"+a+"' does not exist")});Elements.loading.src=a;return Elements.loading.img}
};
Elements.loading.show=function(){Elements.loading.img.length&&Elements.loading.img.fadeIn()};
Elements.loading.hide=function(){Elements.loading.img.length&&Elements.loading.img.fadeOut()};
