/**
 * Element and Image functions
 * From: objects/Elements.js
 * dependancies:  jQuery 1.6+, Cast, Image
 */
var Elements = {
    version : 3.9,
    o       : [],    //stored jquery elements (attach id# to element)
    tick    : 200,   //resize timer tick for 'afterresize' event
    timeout : false  //performing resize
}; //functions shared across all elements
var Images = {
    version:1.2
};   //functions shared across all images

if (typeof jQuery=='function') {
    jQuery.fn.fitIn=function(a){return Images.fitImages(this,a)};
    jQuery.fn.preload=function(){return Images.loadImages(this)};
    jQuery.fn.resize=function(a,b,c){return Elements.resize($(this),a,b,c)};
    jQuery.fn.center=function(a){return Elements.center($(this),a)}; 
}
    Elements.isHTMLNode=function(a){return"object"===typeof Node?a instanceof Node:a&&"object"===typeof a&&"number"===typeof a.nodeType&&"string"===typeof a.nodeName};
    Elements.isHTMLElement=function(a){return"object"===typeof HTMLElement?a instanceof HTMLElement:a&&"object"===typeof a&&null!==a&&1===a.nodeType&&"string"===typeof a.nodeName};
    Elements.isHTMLObject=function(a){return Elements.isHTMLElement()||Elements.isHTMLNode()}; 
    Elements.add=function(a){ie=Elements.o.length;Elements.o[ie]=Cast.cjquery(a);return ie};
    Elements.get=function(a){a=Cast.cint(a);return a<Elements.o.length?Elements.o[a]:jQuery()};
    Elements.popTemplateString=function(b,c,d){b=Cast.cstring(b);c=Cast.cjson(c);d=Cast.cjson(d);return b.replace(/{(\w+)}/g,function(b,a){return"undefined"!=typeof c[a]?c[a]:"undefined"!=typeof d[a]?d[a]:a})}; 
    Elements.checkBox=function(a,b,c,d){a=Cast.cjquery(a);if(!a.length)return jQuery();d=Cast.cboolean(d);a.after("<img />");var e=a.next("img");e.attr("imgOn",b).attr("imgOff",c).attr("src",d?b:c).show();d?a.attr("checked","checked"):a.removeAttr("checked");a.hide();e.click(function(){var a=jQuery(this).prev();a.attr("checked")?a.removeAttr("checked"):a.attr("checked","checked");a.change()});a.change(function(a){a=jQuery(a.target).next("img");a.attr("src",a.attr(jQuery(this).attr("checked")?"imgOn": "imgOff"));return!0});return e};
    Elements.setLink=function(a){a=Cast.cjquery(a);a.css("cursor","pointer");a.click(function(){var a=jQuery(this),c=Cast.cstring(a.attr("href")),a=Cast.cstring(a.attr("target"));c&&(a?window.open(c,a):window.location.href=c)});return this};
    Elements.getContainer=function(a,b){var c=jQuery();b=Cast.cobject(b);Cast.isString(b.parent)?c=a.parents(b.parent):Cast.isObject(b.parent)?c=Cast.cjquery(b.parent):Cast.cboolean(b.parent)&&(c=a.parent());c.length&&(b.width=c.width(),b.height=c.height());if(Cast.cint(b.width)&&Cast.cint(b.height))return{width:b.width,height:b.height,jq:c};c=a.parent();c.length||(c=jQuery(window));return{width:c.width(),height:c.height(),jq:c}};
    Elements.center=function(a,b){var c,d={parent:!1,width:0,height:0,vertical:!0,horizontal:!0,persist:!0};a=Cast.cjquery(a);b=Cast.cobject(b);for(c in d)d[c]="undefined"!=typeof b[c]?b[c]:d[c];container=Elements.getContainer(a,d);parent=container.jq;return!parent.length||d.horizontal&&!d.vertical?Cast.cint(container.width)&&Cast.cint(container.height)?Elements.centerArea(a,container.width,container.height):a.css({"margin-left":"auto","margin-right":"auto","vertical-align":"middle"}):d.persist?Elements.centerParentResize(a, parent):Elements.centerParent(a,parent)};
    Elements.centerParent=function(a,b){var c=Cast.cstring(a.css("position"));return"absolute"==c||"fixed"==c?a.css({left:Math.round((b.outerWidth()||b.width())/2-(a.outerWidth()||a.width())/2)+"px",top:Math.round((b.outerHeight()||b.height())/2-(a.outerHeight()||a.height())/2)+"px"}):a.css({"margin-left":Math.round((b.outerWidth()||b.width())/2-(a.outerWidth()||a.width())/2)+"px","margin-top":Math.round((b.outerHeight()||b.height())/2-(a.outerHeight()||a.height())/2)+"px"})};
    Elements.centerArea=function(a,b,c){var d=Cast.cstring(a.css("position"));return"absolute"==d||"fixed"==d?a.css({left:Math.round(b/2-(a.outerWidth()||a.width())/2)+"px",top:Math.round(c/2-(a.outerHeight()||a.height())/2)+"px"}):a.css({"margin-left":Math.round(b/2-(a.outerWidth()||a.width())/2)+"px","margin-top":Math.round(c/2-(a.outerHeight()||a.height())/2)+"px"})};
    Elements.centerParentResize=function(b,a){b=Cast.cjquery(b);a=Cast.cjquery(a);Elements.centerParent(b,a);if("function"!=typeof a.on)return a.live("resize",function(){Elements.centerParent(b,a)});Elements.startAfterResizeEvent(a);return jQuery(a).on("afterresize",{jqp:a,jqe:b},function(a){Elements.centerParent(a.data.jqe,a.data.jqp)})};
    Elements.toggle=function(c,b,a){a=Cast.cjson(a);c=Cast.cjquery(c);b=Cast.cjquery(b);a.j=Elements.add(c);a.t=Cast.cboolean(a.t,!0);Cast.cboolean(a.w,!1)&&(a.w=Math.max(c.width(),Cast.cint(a.w)));Cast.cboolean(a.h,!0)&&(a.h=Math.max(c.height(),Cast.cint(a.h)));b.data("toggle",Cast.csjson(a));b.click(function(){ajqo=$(this);o=Cast.cjson(ajqo.data("toggle"));o.t=Cast.cboolean(o.t);var a=Cast.cint(o.w),b=Cast.cint(o.h),d=Elements.get(Cast.cint(o.j));a&&(o.t?d.animate({width:0},function(){o.t=!1;ajqo.data("toggle", Cast.csjson(o))}):d.animate({width:a},function(){o.t=!0;ajqo.data("toggle",Cast.csjson(o))}));b&&(o.t?d.animate({height:0},function(){o.t=!1;ajqo.data("toggle",Cast.csjson(o))}):d.animate({height:b},function(){o.t=!0;ajqo.data("toggle",Cast.csjson(o))}));c.trigger("toggled")})};
    Elements.startAfterResizeEvent=function(a){"undefined"==typeof Elements.startAfterResizeEventOn&&("undefined"==typeof a&&(a=window),Elements.startAfterResizeEventOn=!0,Elements.timeout=!1,$(a).on("resize",{jqp:a},function(){Elements.windowTime=new Date;!1===Elements.timeout&&(Elements.timeout=!0,setTimeout(Elements.afterResize,Elements.tick))}))};
    Elements.afterResize=function(a){new Date-Elements.windowTime<Elements.tick?setTimeout(Elements.afterResize,Elements.tick):(Elements.timeout=!1,jQuery(window).trigger("afterresize"))};
    Elements.elementData=function(a,b,c){var d={};a=Cast.cjquery(a);"object"==typeof b?(c=b,b="default"):(b=Cast.cstring(b))||(b="default");Cast.cjson(c);a.each(function(){d=Cast.cjson(a.data(b));jQuery.extend(d,c);a.data(b,d)});return d};
    Elements.unifyDimensions=function(a,b,c){var d=0,e=0;b=Cast.cboolean(b,!0);c=Cast.cboolean(c,!0);a=Cast.cjquery(a);a.each(function(){ajqo=$(this);ajqo.width()>d&&(d=ajqo.width());ajqo.height()>e&&(e=ajqo.height())});a.each(function(){ajqo=$(this);b&&ajqo.width(d);c&&ajqo.height(e)});return a};
    Elements.resize=function(d,a,b,c){Cast.isNumber(a)&&(a+="px");Cast.isNumber(b)&&(b+="px");c=Cast.cint(c);return 0<c?d.animate({width:a,height:b},c,function(a){jQuery(a.target).trigger("afterresize")}):d.css({width:a,height:b}).trigger("afterresize")};
    Elements.loading=function(a,b){Elements.loading.img=$();a=Cast.cstring(a);b=Cast.cjquery(b);b.length||(b=jQuery("body"));if(!a||!b.length)return console.log("Elements.loading img error"),jQuery();Elements.loading.img=jQuery('<img src="'+a+'" style="display:none;" />');Elements.loading.img.appendTo(b);Elements.loading.img.load(function(){$(this).css({position:"fixed","z-index":1E4,left:"50%",top:"50%","margin-left":"-"+Elements.loading.img.width/2+"px","margin-top":"-"+Elements.loading.img.height/ 2+"px"})}).error(function(){console.log("Elements.loading img '"+a+"' does not exist")});Elements.loading.src=a;return Elements.loading.img};
    Elements.loading.show=function(){Elements.loading.img.length&&Elements.loading.img.fadeIn()};
    Elements.loading.hide=function(){Elements.loading.img.length&&Elements.loading.img.fadeOut()};
    Images.setLoaded=function(a,b){b=Cast.cboolean(b,!0);Cast.cjquery(a).data("loaded",b);return this};
    Images.isLoaded=function(a){return Cast.cboolean(Cast.cjquery(a).data("loaded"))};
    Images.loadImages=function(a){a=Cast.cjquery(a);var b=this;return jQuery.Deferred(function(c){a.each(function(d,e){b.loadImage(jQuery(e)).done(function(b,e,g){d>=a.length-1&&c.resolve(a)})});a.length||c.reject(a,"no image elements to preload")}).promise()};
    Images.loadImage=function(a){var b=this;return jQuery.Deferred(function(c){a=Cast.cjquery(a);var d=new Image,e=Cast.cstring(a.attr("src"));d.onload=function(){Elements.elementData(a,{owidth:d.width,oheight:d.height});b.setLoaded(a);c.resolve(d.width,d.height,a)};d.onerror=function(b){Elements.elementData(a,{owidth:a.width(),oheight:a.height()});c.reject(a.width(),a.height(),a,"invalid src: "+e)};d.src=e;d.complete&&(Elements.elementData(a,{owidth:d.width,oheight:d.height}),b.setLoaded(a),c.resolve(d.width, d.height,a))}).promise()};
    Images.getRatioW=function(a,b){var c=Cast.cobject(Elements.elementData(a)),c=Cast.cint(c.owidth)/Cast.cint(c.oheight);return isNaN(c)?0:b*c};
    Images.getRatioH=function(a,b){var c=Cast.cobject(Elements.elementData(a)),c=Cast.cint(c.oheight)/Cast.cint(c.owidth);return isNaN(c)?0:b*c};
    Images.resizeW=function(a,b,c){return Elements.resize(a,b,this.getRatioH(a,b),c)};
    Images.resizeH=function(a,b,c){return Elements.resize(a,this.getRatioW(a,b),b,c)};
    Images.fitInParent=function(a,b,c,d){b=Elements.getContainer(a,b);return this.fitInArea(a,b.width,b.height,c,d)};
    Images.fitInArea=function(a,b,c,d,e){e=Cast.cboolean(e);return e==Math.abs(a.width()-b)<Math.abs(a.height()-c)?this.resizeW(a,b,d):this.resizeH(a,c,d)};
    Images.fitImages=function(a,b){a=Cast.cjquery(a);var c=this;return jQuery.Deferred(function(d){a.each(function(e,f){c.fitImage(jQuery(f),b).done(function(b,c,f){e>=a.length-1&&d.resolve(f)})});a.length||d.reject(a)}).promise()};
    Images.fitImage=function(a,b){var c=this;return this.loadImage(a).done(function(a,e,f){data={parent:!1,width:0,height:0,speed:0,bound:!0};jQuery.extend(data,Cast.cobject(b));Elements.elementData(f,"container",data);a=Elements.getContainer(f,data);c.fitInArea(f,a.width,a.height,data.speed,!data.bound)})};
    Images.exists=function(a){return jQuery.Deferred(function(b){"undefined"!=typeof a&&a||b.reject(b,"fail","blank url","");jQuery("<img src='"+a+"' />").load(function(){b.resolve(a,"success",b)}).error(function(){b.reject(b,"fail","error loading image",a)})}).promise()};
    Images.svg=function(a,b){a=Cast.cjquery(a);b=Cast.cstring(b);if(!Images.svgSupported())return a;a.each(function(){var a=$(this);b||(b=Cast.cstring(a.attr("svg")));"img"==a.prop("tagName")?a.attr("src",b):a.attr("background-image","url("+b+")")});return a};
    Images.svgSupported=function(){if("undefined"!=typeof Images.bSvgSupported)return Images.bSvgSupported;var a=document.createElement("img");a.setAttribute("src","data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNzUiIGhlaWdodD0iMjc1Ij48L3N2Zz4%3D");Images.bSvgSupported=a.complete;return Images.bSvgSupported};
    